import { Callout, Tabs, Steps } from 'nextra/components'

# Fluent Bit Log Forwarder

[Fluent Bit](https://fluentbit.io/) is a lightweight log processor and forwarder that can send data to RunReveal.

## Quick Start

This setup demonstrates reading logs from a local file and forwarding them to your RunReveal webhook. The example creates test JSON logs, configures Fluent Bit to monitor the log file, and sends events to RunReveal in real-time.

<Steps>

### Step 1: Create a Webhook Source in RunReveal

This step creates a webhook source in RunReveal and generates the webhook URL you'll need for Fluent Bit configuration.

1. **Navigate to RunReveal**: Go to your RunReveal dashboard
2. **Create Source**: Click on "Sources" in the left sidebar
3. **Add Webhook**: Create a source for [Structured Webhook or Generic Webhook](/sources/Forwarders#structured-webhooks) based on your data format.
4. **Configure**: Give your webhook a name and description
5. **Copy URL**: Copy the generated webhook URL to use in your configuration. (It's always available after you save the source)

### Step 2: Install Fluent Bit

This step installs Fluent Bit on your system using your preferred method. Fluent Bit will be used to collect, process, and forward logs to RunReveal.

<Tabs items={['macOS', 'Ubuntu/Debian', 'CentOS/RHEL', 'Docker', 'Binary']}>
  <Tabs.Tab>
```bash
# Install via Homebrew
brew install fluent-bit

# Verify installation
fluent-bit --version
```
  </Tabs.Tab>
  <Tabs.Tab>
```bash
# Add Fluent Bit repository
curl https://packages.fluentbit.io/fluentbit.key | gpg --dearmor > fluentbit-key.gpg
sudo install -o root -g root -m 644 fluentbit-key.gpg /etc/apt/trusted.gpg.d/
sudo sh -c 'echo "deb https://packages.fluentbit.io/ubuntu/$(lsb_release -sc) $(lsb_release -sc) main" > /etc/apt/sources.list.d/fluent-bit.list'

# Install Fluent Bit
sudo apt-get update
sudo apt-get install td-agent-bit

# Verify installation
td-agent-bit --version
```
  </Tabs.Tab>
  <Tabs.Tab>
```bash
# Add Fluent Bit repository
sudo rpm --import https://packages.fluentbit.io/fluentbit.key
sudo tee /etc/yum.repos.d/fluent-bit.repo << EOF
[fluent-bit]
name = Fluent Bit
baseurl = https://packages.fluentbit.io/centos/\$releasever/\$basearch/
gpgcheck=1
repo_gpgcheck=1
enabled=1
gpgkey=https://packages.fluentbit.io/fluentbit.key
EOF

# Install Fluent Bit
sudo yum install td-agent-bit

# Verify installation
td-agent-bit --version
```
  </Tabs.Tab>
  <Tabs.Tab>
```bash
# Pull Fluent Bit image
docker pull fluent/fluent-bit:latest

# Create config directory
mkdir -p $(pwd)/fluent-bit-config

# Run Fluent Bit container
docker run -d \
  --name fluent-bit \
  -v $(pwd)/fluent-bit-config:/fluent-bit/etc \
  -v /var/log:/var/log:ro \
  fluent/fluent-bit:latest

# Verify container is running
docker ps | grep fluent-bit
```
  </Tabs.Tab>
  <Tabs.Tab>
```bash
# Download Fluent Bit binary
curl -L -O https://github.com/fluent/fluent-bit/releases/latest/download/fluent-bit-1.9.0-linux-x64.tar.gz
tar -xzf fluent-bit-1.9.0-linux-x64.tar.gz
cd fluent-bit-1.9.0-linux-x64

# Verify installation
./bin/fluent-bit --version
```
  </Tabs.Tab>
</Tabs>

### Step 3: Create Test Logs

This step creates sample log files with security events that Fluent Bit will monitor and forward to RunReveal. These logs simulate real application events for testing purposes.

<Tabs items={['macOS/Linux', 'Windows']}>
  <Tabs.Tab>
```bash
# Create logs directory
mkdir -p test-logs

# Create test log file with proper JSON structure
cat > test-logs/app.log << 'EOF'
{"eventTime": "2025-08-04T19:55:26Z", "eventName": "UserLogin", "action": "authentication", "actor": {"username": "john.doe", "userAgent": "Mozilla/5.0"}, "src": {"ip": "192.168.1.100"}, "outcome": "success", "service": "web-api"}
{"eventTime": "2025-08-04T19:56:00Z", "eventName": "FileAccess", "action": "file_read", "actor": {"username": "jane.smith"}, "object": {"path": "/secure/documents/report.pdf"}, "outcome": "allowed", "service": "file-server"}
{"eventTime": "2025-08-04T19:57:15Z", "eventName": "SuspiciousLogin", "action": "authentication", "actor": {"username": "admin", "userAgent": "curl/7.68.0"}, "src": {"ip": "10.0.0.15"}, "outcome": "failure", "service": "admin-api"}
EOF

# Verify log file was created
ls -la test-logs/
cat test-logs/app.log
```
  </Tabs.Tab>
  <Tabs.Tab>
```powershell
# Create logs directory
mkdir C:\test-logs

# Create test log file
echo {"eventTime": "2025-08-04T19:55:26Z", "eventName": "UserLogin", "action": "authentication", "actor": {"username": "john.doe", "userAgent": "Mozilla/5.0"}, "src": {"ip": "192.168.1.100"}, "outcome": "success", "service": "web-api"} > C:\test-logs\app.log
echo {"eventTime": "2025-08-04T19:56:00Z", "eventName": "FileAccess", "action": "file_read", "actor": {"username": "jane.smith"}, "object": {"path": "/secure/documents/report.pdf"}, "outcome": "allowed", "service": "file-server"} >> C:\test-logs\app.log

# Verify log file was created
dir C:\test-logs\
```
  </Tabs.Tab>
</Tabs>

### Step 4: Configure Fluent Bit

This step creates the Fluent Bit configuration file that tells Fluent Bit where to find logs and how to send them to RunReveal. The configuration defines both the input (where logs come from) and the output (where logs go).

<Tabs items={['Conf Config', 'Docker Config']}>
  <Tabs.Tab>
Create `fluent-bit.conf`:

```ini
[SERVICE]
    Flush         1
    Daemon        off
    Log_Level     info
    Parsers_File  parsers.conf

[INPUT]
    Name              tail
    Path              ./test-logs/*.log
    Parser            json
    Tag               logs
    Refresh_Interval  5
    Mem_Buf_Limit     5MB
    Skip_Long_Lines   On
    Read_from_Head    On

[INPUT]
    Name              dummy
    Rate              0.1
    Dummy             {"message":"Test from Fluent Bit","timestamp":"2025-08-04T19:55:26.300Z"}
    Tag               test

[FILTER]
    Name              record_modifier
    Match             *
    Add               source fluent-bit
    Add               host ${HOSTNAME}
    Add               ingestion_timestamp ${time}
    Add               environment production

[OUTPUT]
    Name              http
    Match             *
    Host              api.runreveal.com
    Port              443
    URI               /sources/hook/30pw8Fynw5W7PzjbnRyxnfMsID2
    Method            POST
    Format            json
    tls               On
    tls.verify        On
    Header            Content-Type application/json
    Retry_Limit       3
    net.connect_timeout 30
    net.keepalive     On
    net.keepalive_idle_timeout 10
```

Create `parsers.conf`:

```ini
[PARSER]
    Name        json
    Format      json
    Time_Key    eventTime
    Time_Format %Y-%m-%dT%H:%M:%S%z
    Time_Keep   On
```
  </Tabs.Tab>
  <Tabs.Tab>
Create `docker-compose.yml`:

```yaml
version: '3.8'
services:
  fluent-bit:
    image: fluent/fluent-bit:latest
    container_name: fluent-bit
    volumes:
      - ./fluent-bit.conf:/fluent-bit/etc/fluent-bit.conf
      - ./parsers.conf:/fluent-bit/etc/parsers.conf
      - ./test-logs:/var/log/app:ro
    ports:
      - "24224:24224"
      - "24224:24224/udp"
    environment:
      - FLUENT_BIT_CONF=fluent-bit.conf
    command: fluent-bit -c /fluent-bit/etc/fluent-bit.conf
```
  </Tabs.Tab>
</Tabs>

<Callout type="info">
The configuration above uses the actual webhook URL `30pw8Fynw5W7PzjbnRyxnfMsID2` from earlier examples. Replace this with your own webhook ID if different.
</Callout>

### Step 5: Start Fluent Bit

This step starts Fluent Bit with your configuration, which will begin monitoring the log files and forwarding events to RunReveal in real-time. Fluent Bit will continuously watch for new log entries and send them to your webhook.

<Tabs items={['Local', 'Docker']}>
  <Tabs.Tab>
```bash
# Test configuration syntax
fluent-bit -c fluent-bit.conf --dry-run

# Run Fluent Bit with verbose logging
fluent-bit -c fluent-bit.conf -v

# Run Fluent Bit normally
fluent-bit -c fluent-bit.conf
```
  </Tabs.Tab>
  <Tabs.Tab>
```bash
# Start with Docker Compose
docker-compose up -d

# Check logs
docker-compose logs -f fluent-bit

# Stop when done testing
docker-compose down
```
  </Tabs.Tab>
</Tabs>

### Step 6: Validate Delivery

This step verifies that logs are being successfully delivered to RunReveal by checking the webhook source and querying for events.

1. **Check Webhook Source**: Go to RunReveal → Sources → Your Webhook Source
2. **View Recent Events**: Look for incoming events in the source details
3. **Query for Events**: Use the search bar to query:
   ```sql
   SELECT * FROM logs 
   WHERE sourceType = 'structured-webhook' 
   ORDER BY receivedAt DESC 
   LIMIT 10;
   ```
4. **Verify Data**: Confirm that your test log events appear in the results with fields like:
   - `eventName`: "UserLogin", "FileAccess", etc.
   - `source`: "fluent-bit"
   - `host`: Your machine hostname
   - Original JSON data in `rawLog` field

If you see your test events in RunReveal, Fluent Bit is successfully forwarding logs to your webhook.

### Step 7: Add More Test Data

To see real-time log forwarding in action:

```bash
# Add new log entries to see them appear in RunReveal
echo '{"eventTime": "'$(date -u +%Y-%m-%dT%H:%M:%SZ)'", "eventName": "DataExport", "action": "data_download", "actor": {"username": "test.user"}, "object": {"path": "/reports/sensitive.csv"}, "outcome": "success", "service": "data-api"}' >> test-logs/app.log

# Watch Fluent Bit logs to see processing
tail -f fluent-bit.log
```

</Steps>

## Advanced Fluent Bit Configuration Examples

<Tabs items={['Production Setup', 'Multi-Source', 'Security Events']}>
  <Tabs.Tab>

### Production Configuration

```ini
[SERVICE]
    Flush         5
    Daemon        on
    Log_Level     warn
    Parsers_File  parsers.conf
    HTTP_Server   On
    HTTP_Listen   0.0.0.0
    HTTP_Port     2020

[INPUT]
    Name              tail
    Path              /var/log/app/*.log
    Parser            json
    Tag               app.logs
    Refresh_Interval  10
    Mem_Buf_Limit     32MB
    Skip_Long_Lines   On
    Read_from_Head    Off
    DB                /var/log/flb_app.db

[INPUT]
    Name              tail
    Path              /var/log/audit/*.log
    Parser            json
    Tag               audit.logs
    Refresh_Interval  5
    Mem_Buf_Limit     16MB
    DB                /var/log/flb_audit.db

[FILTER]
    Name              record_modifier
    Match             *
    Add               environment production
    Add               datacenter us-east-1
    Add               host ${HOSTNAME}

[FILTER]
    Name              grep
    Match             app.logs
    Regex             eventName (UserLogin|FileAccess|DataExport|SecurityAlert)

[OUTPUT]
    Name              http
    Match             *
    Host              api.runreveal.com
    Port              443
    URI               /sources/hook/YOUR_WEBHOOK_ID
    Method            POST
    Format            json
    tls               On
    tls.verify        On
    Header            Content-Type application/json
    Retry_Limit       5
    net.connect_timeout 30
    net.keepalive     On
```

  </Tabs.Tab>
  <Tabs.Tab>

### Multiple Source Configuration

```ini
[SERVICE]
    Flush         1
    Log_Level     info
    Parsers_File  parsers.conf

# Application logs
[INPUT]
    Name              tail
    Path              /app/logs/*.log
    Parser            json
    Tag               app
    Read_from_Head    On

# System logs
[INPUT]
    Name              systemd
    Tag               system
    Systemd_Filter    _SYSTEMD_UNIT=ssh.service
    Systemd_Filter    _SYSTEMD_UNIT=nginx.service

# Docker logs
[INPUT]
    Name              docker
    Tag               docker
    Docker_Mode       On

# Network logs
[INPUT]
    Name              netif
    Tag               network
    Interface         eth0
    Interval_Sec      5

[FILTER]
    Name              record_modifier
    Match             app
    Add               log_type application

[FILTER]
    Name              record_modifier
    Match             system
    Add               log_type system

[FILTER]
    Name              record_modifier
    Match             docker
    Add               log_type container

[OUTPUT]
    Name              http
    Match             *
    Host              api.runreveal.com
    Port              443
    URI               /sources/hook/YOUR_WEBHOOK_ID
    Format            json
    tls               On
```

  </Tabs.Tab>
  <Tabs.Tab>

### Security Events Focus

```ini
[SERVICE]
    Flush         1
    Log_Level     info
    Parsers_File  parsers.conf

[INPUT]
    Name              tail
    Path              /var/log/auth.log
    Parser            syslog
    Tag               auth
    Read_from_Head    On

[INPUT]
    Name              tail
    Path              /var/log/fail2ban.log
    Parser            fail2ban
    Tag               security
    Read_from_Head    On

[INPUT]
    Name              tail
    Path              /app/security/*.log
    Parser            json
    Tag               app.security
    Read_from_Head    On

[FILTER]
    Name              grep
    Match             auth
    Regex             message (Failed password|Invalid user|authentication failure)

[FILTER]
    Name              grep
    Match             app.security
    Regex             eventName (SuspiciousLogin|BruteForce|Unauthorized|DataBreach)

[FILTER]
    Name              record_modifier
    Match             *
    Add               category security
    Add               priority high
    Add               source_host ${HOSTNAME}

[OUTPUT]
    Name              http
    Match             *
    Host              api.runreveal.com
    Port              443
    URI               /sources/hook/YOUR_WEBHOOK_ID
    Format            json
    tls               On
    Header            Content-Type application/json
```

  </Tabs.Tab>
</Tabs>

## Fluent Bit Configuration Reference

<Tabs items={['Inputs', 'Filters', 'Outputs', 'Parsers']}>
  <Tabs.Tab>

### Inputs

Inputs collect data from various sources. For RunReveal, you'll typically use file inputs or system inputs.

**Tail Input (Most Common)**
```ini
[INPUT]
    Name              tail
    Path              /var/log/app/*.log,/var/log/api/*.json
    Parser            json
    Tag               app.logs
    Read_from_Head    true
    Mem_Buf_Limit     5MB
    Skip_Long_Lines   On
    Refresh_Interval  5
    DB                /var/log/flb.db
```

**System Log Input**
```ini
[INPUT]
    Name        syslog
    Tag         system.logs
    Parser      syslog
    Listen      0.0.0.0
    Port        5140
    Mode        tcp
```

**Docker Input**
```ini
[INPUT]
    Name        docker
    Tag         docker.logs
    Parser      docker
    Docker_Mode On
```

**Forward Input (From other Fluent Bit/Fluentd)**
```ini
[INPUT]
    Name        forward
    Tag         forwarded
    Listen      0.0.0.0
    Port        24224
```

  </Tabs.Tab>
  <Tabs.Tab>

### Filters

Filters modify and enrich your data before sending to RunReveal.

**Add Metadata**
```ini
[FILTER]
    Name        record_modifier
    Match       *
    Add         host ${HOSTNAME}
    Add         environment production
    Add         ingestion_timestamp ${time}
    Add         datacenter us-west-2
```

**Filter Events**
```ini
[FILTER]
    Name        grep
    Match       app.logs
    Regex       level (ERROR|WARN|FATAL)
```

**Parse JSON**
```ini
[FILTER]
    Name        parser
    Match       app.logs
    Key_Name    message
    Parser      json
    Reserve_Data On
```

**Lua Scripting**
```ini
[FILTER]
    Name        lua
    Match       app.logs
    Script      /path/to/script.lua
    Call        cb_enrich_data
```

**Throttle (Rate Limiting)**
```ini
[FILTER]
    Name        throttle
    Match       *
    Rate        1000
    Window      5
    Interval    1m
```

**Kubernetes Metadata**
```ini
[FILTER]
    Name                kubernetes
    Match               kube.*
    Kube_URL            https://kubernetes.default.svc:443
    Kube_CA_File        /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
    Kube_Token_File     /var/run/secrets/kubernetes.io/serviceaccount/token
    Merge_Log           On
    K8S-Logging.Parser  On
    K8S-Logging.Exclude Off
```

  </Tabs.Tab>
  <Tabs.Tab>

### Outputs

Outputs send processed data to external systems.

**HTTP Output for RunReveal (Recommended)**
```ini
[OUTPUT]
    Name        http
    Match       *
    Host        api.runreveal.com
    Port        443
    URI         /sources/hook/YOUR_WEBHOOK_ID
    Method      POST
    Format      json
    tls         On
    tls.verify  On
    Header      Content-Type application/json
    Retry_Limit 3
    net.connect_timeout 30
    net.keepalive On
    net.keepalive_idle_timeout 10
```

**File Output (Backup)**
```ini
[OUTPUT]
    Name        file
    Match       *
    Path        /var/log/backup/
    File        fluent-bit-backup.log
    Format      json_lines
```

**Forward Output (To Another Fluent Bit)**
```ini
[OUTPUT]
    Name        forward
    Match       *
    Host        192.168.1.100
    Port        24224
    tls         On
    tls.verify  On
```

**Standard Output (Debug)**
```ini
[OUTPUT]
    Name   stdout
    Match  *
    Format json_lines
```

  </Tabs.Tab>
  <Tabs.Tab>

### Parsers

Parsers structure your log data for better analysis.

**JSON Parser**
```ini
[PARSER]
    Name        json
    Format      json
    Time_Key    timestamp
    Time_Format %Y-%m-%dT%H:%M:%S%z
    Time_Keep   On
```

**Regex Parser**
```ini
[PARSER]
    Name        apache
    Format      regex
    Regex       ^(?<host>[^ ]*) [^ ]* (?<user>[^ ]*) \[(?<time>[^\]]*)\] "(?<method>\S+)(?: +(?<path>[^ ]*) +\S*)?" (?<code>[^ ]*) (?<size>[^ ]*)
    Time_Key    time
    Time_Format %d/%b/%Y:%H:%M:%S %z
```

**Docker Parser**
```ini
[PARSER]
    Name        docker
    Format      json
    Time_Key    time
    Time_Format %Y-%m-%dT%H:%M:%S.%LZ
    Time_Keep   On
```

**Syslog Parser**
```ini
[PARSER]
    Name        syslog
    Format      regex
    Regex       ^\<(?<pri>[0-9]+)\>(?<time>[^ ]* {1,2}[^ ]* [^ ]*) (?<host>[^ ]*) (?<ident>[a-zA-Z0-9_\/\.\-]*)(?:\[(?<pid>[0-9]+)\])?(?:[^\:]*\:)? *(?<message>.*)$
    Time_Key    time
    Time_Format %b %d %H:%M:%S
```

**Custom Application Parser**
```ini
[PARSER]
    Name        app_log
    Format      regex
    Regex       ^\[(?<timestamp>[^\]]+)\] (?<level>\w+): (?<message>.*)
    Time_Key    timestamp
    Time_Format %Y-%m-%d %H:%M:%S
```

  </Tabs.Tab>
</Tabs>

---

## Next Steps

Now that you have Fluent Bit configured and logs flowing to RunReveal, explore these guides:

- **[Detections](/detections)** - Create security detection rules for your Fluent Bit logs
- **[Sigma Streaming](/detections/sigma-streaming)** - Use Sigma rules for standardized threat detection
- **[Detection as Code](/detections/detection-as-code)** - Manage detections through version control
- **[AI Chat](/ai-chat)** - Use AI-powered analysis for threat hunting and investigation
- **[Notifications](/notifications)** - Set up alerting for critical security events
- **[Enrichments](/enrichments)** - Add context and metadata to your events

---

## Troubleshooting

### Fluent Bit Won't Start

1. **Check Configuration Syntax**
   ```bash
   fluent-bit -c fluent-bit.conf --dry-run
   ```

2. **Verify File Permissions**
   ```bash
   # Check log file permissions
   ls -la test-logs/
   
   # Ensure Fluent Bit can read files
   chmod 644 test-logs/*.log
   ```

3. **Review Fluent Bit Logs**
   ```bash
   fluent-bit -c fluent-bit.conf -vv
   ```

### Logs Not Reaching RunReveal

1. **Test Webhook Manually**
   ```bash
   curl -X POST https://api.runreveal.com/sources/hook/30pw8Fynw5W7PzjbnRyxnfMsID2 \
     -H "Content-Type: application/json" \
     -d '{"test": "message", "timestamp": "'$(date -u +%Y-%m-%dT%H:%M:%SZ)'"}'
   ```

2. **Check Network Connectivity**
   ```bash
   # Test DNS resolution
   nslookup api.runreveal.com
   
   # Test HTTPS connectivity
   curl -I https://api.runreveal.com
   ```

3. **Validate Configuration**
   ```bash
   # Check if files are being read
   fluent-bit -c fluent-bit.conf -vv | grep -i "tail"
   
   # Monitor HTTP output
   fluent-bit -c fluent-bit.conf -vv | grep -i "http"
   ```

### High Resource Usage

1. **Optimize Buffer Settings**
   ```ini
   [INPUT]
       Mem_Buf_Limit     5MB    # Reduce if using too much memory
       Refresh_Interval  10     # Increase to reduce CPU usage
   ```

2. **Add Rate Limiting**
   ```ini
   [FILTER]
       Name        throttle
       Match       *
       Rate        1000    # Max 1000 records per second
       Window      5       # Time window in seconds
       Interval    1m      # Print stats every minute
   ```

3. **Monitor Resources**
   ```bash
   # Monitor Fluent Bit process
   top -p $(pgrep fluent-bit)
   
   # Check memory usage
   ps aux | grep fluent-bit
   ```

### Data Format Issues

1. **Test JSON Parsing**
   ```bash
   # Validate JSON in your log files
   cat test-logs/app.log | python -m json.tool
   ```

2. **Check Parser Configuration**
   ```bash
   # Test with simple input first
   echo '{"test": "message"}' | fluent-bit -c fluent-bit.conf
   ```

3. **Debug Output Format**
   ```ini
   # Add stdout output for debugging
   [OUTPUT]
       Name   stdout
       Match  *
       Format json_lines
   ```

## Resources

- [Fluent Bit Official Documentation](https://docs.fluentbit.io/)
- [Fluent Bit Configuration Examples](https://github.com/fluent/fluent-bit/tree/master/conf)
- [RunReveal Sources Documentation](/sources)
- [RunReveal Detection Guide](/detections)