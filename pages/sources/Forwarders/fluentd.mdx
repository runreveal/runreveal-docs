---
title: 'Fluentd Log Forwarder'
description: 'Configure Fluentd to forward logs to RunReveal using webhooks'
---

import { Callout, Tabs, Steps } from 'nextra/components'

# Fluentd Log Forwarder

<Callout type="info">
**Before you begin**: Replace `YOUR_WEBHOOK_URL` with your actual RunReveal webhook URL from Step 1.
</Callout>

[Fluentd](https://docs.fluentd.org/) is a data collector that can route logs to multiple destinations including RunReveal. It's designed to collect, parse, filter, and forward logs to various destinations, making it ideal for sending data to RunReveal.

---

## Quick Start

This setup demonstrates reading logs from a local file and forwarding them to your RunReveal webhook. The example creates test JSON logs, configures Fluentd to monitor the log file, and sends events to RunReveal in real-time.

<Steps>

### Step 1: Create a Webhook Source in RunReveal

This step creates a webhook source in RunReveal and generates the webhook URL you'll need for Fluentd configuration.

1. **Navigate to RunReveal**: Go to your RunReveal dashboard
2. **Create Source**: Click on "Sources" in the left sidebar
3. **Add Webhook**: Create a source for "[Structured Webhook or Generic Webhook](/sources/Forwarders#structured-webhooks)" based on your data format.
4. **Configure**: Give your webhook a name and description
5. **Copy URL**: Copy the generated webhook URL to use in your configuration. (It's always available after you save the source)

### Step 2: Install Fluentd

This step installs Fluentd on your system using your preferred method. Fluentd will be used to collect, process, and forward logs to RunReveal.

<Tabs items={['macOS', 'Ubuntu/Debian', 'CentOS/RHEL', 'Docker', 'RubyGems']}>
  <Tabs.Tab>

```bash filename="install-macos.sh" copy
# Install using Homebrew
brew install fluentd

# Create config directory
mkdir -p ~/.config/fluentd

# Verify installation
fluentd --version
```

  </Tabs.Tab>
  <Tabs.Tab>

```bash filename="install-ubuntu.sh" copy
# Add Fluentd repository
curl -fsSL https://toolbelt.treasuredata.com/sh/install-ubuntu-focal-td-agent4.sh | sh

# Install Fluentd
sudo apt update
sudo apt install td-agent

# Enable service
sudo systemctl enable td-agent

# Verify installation
fluentd --version
```

  </Tabs.Tab>
  <Tabs.Tab>

```bash filename="install-centos.sh" copy
# Add Fluentd repository
curl -fsSL https://toolbelt.treasuredata.com/sh/install-redhat-td-agent4.sh | sh

# Install Fluentd
sudo yum install td-agent

# Enable service
sudo systemctl enable td-agent

# Verify installation
fluentd --version
```

  </Tabs.Tab>
  <Tabs.Tab>

```bash filename="install-docker.sh" copy
# Pull Fluentd image
docker pull fluent/fluentd:latest

# Create config directory
mkdir -p $(pwd)/fluentd-config

# Run Fluentd container
docker run -d \
  --name fluentd \
  -v $(pwd)/fluentd-config:/fluentd/etc \
  -v ~/logs:/logs \
  fluent/fluentd:latest
```

  </Tabs.Tab>
  <Tabs.Tab>

```bash filename="install-rubygems.sh" copy
# Install using RubyGems
sudo gem install fluentd --no-doc

# Create config directory
mkdir -p ~/.config/fluentd

# Verify installation
fluentd --version
```

  </Tabs.Tab>
</Tabs>

### Step 3: Create Test Logs

This step creates sample log files with security events that Fluentd will monitor and forward to RunReveal. These logs simulate real application events for testing purposes.

<Tabs items={['macOS/Linux', 'Windows']}>
  <Tabs.Tab>

```bash filename="create-logs-macos-linux.sh" copy
# Create log directory in your home directory
mkdir -p ~/logs/app

# Create sample application logs
cat > ~/logs/app/application.log << EOF
{"timestamp":"2024-01-15T10:30:00Z","level":"INFO","message":"User login successful","user_id":"12345","ip":"192.168.1.100"}
{"timestamp":"2024-01-15T10:31:00Z","level":"WARN","message":"Failed login attempt","user_id":"unknown","ip":"192.168.1.101"}
{"timestamp":"2024-01-15T10:32:00Z","level":"ERROR","message":"Database connection failed","error":"timeout","retry_count":3}
EOF

# Verify logs were created
ls -la ~/logs/app/
cat ~/logs/app/application.log
```

  </Tabs.Tab>
  <Tabs.Tab>

```powershell filename="create-logs-windows.ps1" copy
# Create log directory in your home directory
New-Item -ItemType Directory -Path "$env:USERPROFILE\logs\app" -Force

# Create sample application logs
@"
{"timestamp":"2024-01-15T10:30:00Z","level":"INFO","message":"User login successful","user_id":"12345","ip":"192.168.1.100"}
{"timestamp":"2024-01-15T10:31:00Z","level":"WARN","message":"Failed login attempt","user_id":"unknown","ip":"192.168.1.101"}
{"timestamp":"2024-01-15T10:32:00Z","level":"ERROR","message":"Database connection failed","error":"timeout","retry_count":3}
"@ | Out-File -FilePath "$env:USERPROFILE\logs\app\application.log" -Encoding UTF8

# Verify logs were created
Get-ChildItem "$env:USERPROFILE\logs\app\"
Get-Content "$env:USERPROFILE\logs\app\application.log"
```

  </Tabs.Tab>
</Tabs>

### Step 4: Configure Fluentd

This step creates the Fluentd configuration file that defines how to collect logs and send them to RunReveal.

```xml filename="fluentd.conf" copy
# fluentd.conf
<source>
  @type tail
  path ~/logs/app/*.log
  pos_file ~/logs/fluentd/application.log.pos
  tag application
  <parse>
    @type json
  </parse>
</source>

<filter application>
  @type record_transformer
  <record>
    eventName LogEvent
    eventTime ${time}
    readOnly false
    service.name application
    tags.source fluentd
  </record>
</filter>

<match application>
  @type http
  endpoint YOUR_WEBHOOK_URL
  http_method post
  headers {"Content-Type": "application/json"}
  <format>
    @type json
  </format>
  <buffer>
    @type memory
    flush_interval 5s
    chunk_limit_size 2m
    queue_limit_length 8
  </buffer>
</match>
```

### Step 5: Start Fluentd

This step starts Fluentd with your configuration, which will begin monitoring the log files and forwarding events to RunReveal in real-time. Fluentd will continuously watch for new log entries and send them to your webhook.

```bash filename="start-fluentd.sh" copy
# Validate configuration
fluentd -c fluentd.conf --dry-run

# Test configuration locally (optional)
fluentd -c fluentd.conf --dry-run --verbose

# Run Fluentd in foreground
fluentd -c fluentd.conf

# Run Fluentd in background
fluentd -c fluentd.conf -d
```

**Local Testing Commands:**

```bash filename="test-locally.sh" copy
# Test with a simple HTTP endpoint first
curl -X POST http://localhost:8080/test -H "Content-Type: application/json" -d '{"test": "data"}'

# Test Fluentd configuration with local file output
# Create a test config that outputs to a local file instead of HTTP
cat > fluentd-test.conf << EOF
<source>
  @type tail
  path ~/logs/app/*.log
  tag test.logs
  <parse>
    @type json
  </parse>
</source>

<match test.logs>
  @type file
  path /tmp/fluentd-test.log
  <format>
    @type json
  </format>
</match>
EOF

# Run test configuration
fluentd -c fluentd-test.conf

# Check the test output
tail -f /tmp/fluentd-test.log
```

### Step 6: Validate Delivery

This step verifies that logs are successfully being delivered to RunReveal by checking the webhook source and querying for events.

1. **Check Webhook Source**: Go to RunReveal → Sources → Your webhook source
2. **View Recent Events**: Look for recent events in the source details
3. **Query for Events**: Use the query `sourceType = 'webhook'` or `sourceType = 'structured-webhook'` to find your events

</Steps>

---

## Fluentd Configuration

<Tabs items={['Sources', 'Filters', 'Outputs']}>
  <Tabs.Tab>

### Sources

Sources collect data from various inputs. For RunReveal, you'll typically use file sources or system sources. See the [Fluentd Sources Reference](https://docs.fluentd.org/input) for comprehensive documentation.

**File Source Example**
```xml filename="file-source.xml" copy
<source>
  @type tail
  path /var/log/app/*.log
  pos_file /var/log/fluentd/app.log.pos
  tag app.logs
  <parse>
    @type json
  </parse>
</source>
```

Collects application logs in JSON format, perfect for security event analysis and compliance reporting.

**System Source Example**
```xml filename="system-source.xml" copy
<source>
  @type tail
  path /var/log/syslog
  pos_file /var/log/fluentd/syslog.pos
  tag system.logs
  <parse>
    @type syslog
  </parse>
</source>
```

Captures system authentication and authorization events, essential for security monitoring and threat detection.

**Docker Source Example**
```xml filename="docker-source.xml" copy
<source>
  @type tail
  path /var/lib/docker/containers/*/*.log
  pos_file /var/log/fluentd/docker.log.pos
  tag container.logs
  <parse>
    @type json
    time_format %Y-%m-%dT%H:%M:%S.%L
  </parse>
</source>
```

Monitors containerized applications for security incidents, performance issues, and compliance violations.

  </Tabs.Tab>
  <Tabs.Tab>

### Filters

Filters process and transform data as it flows through the pipeline. For RunReveal, you'll typically use record transformers, parsers, or grep filters. See the [Fluentd Filters Reference](https://docs.fluentd.org/filter) for comprehensive documentation.

**Record Transformer Example**
```xml filename="record-transformer.xml" copy
<filter app.logs>
  @type record_transformer
  <record>
    eventName LogEvent
    eventTime ${time}
    readOnly false
    service.name application
    tags.source fluentd
  </record>
</filter>
```

Transforms log records to match RunReveal's expected format and adds metadata for better context.

**Parser Example**
```xml filename="parser.xml" copy
<filter app.logs>
  @type parser
  key_name message
  <parse>
    @type json
  </parse>
</filter>
```

Parses JSON-formatted logs into structured fields for better analysis and querying.

**Grep Filter Example**
```xml filename="grep-filter.xml" copy
<filter app.logs>
  @type grep
  regexp1 level ERROR|WARN|CRITICAL
</filter>
```

Filters logs to include only security-relevant events, reducing noise and improving detection accuracy.

  </Tabs.Tab>
  <Tabs.Tab>

### Outputs

Outputs send data to external destinations. For RunReveal, you'll configure HTTP output to send logs via webhooks. See the [Fluentd Outputs Reference](https://docs.fluentd.org/output) for comprehensive documentation.

**HTTP Output Example**
```xml filename="http-output.xml" copy
<match app.logs>
  @type http
  endpoint YOUR_WEBHOOK_URL
  http_method post
  headers {"Content-Type": "application/json"}
  <format>
    @type json
  </format>
  <buffer>
    @type memory
    flush_interval 5s
    chunk_limit_size 2m
    queue_limit_length 8
  </buffer>
</match>
```

Sends logs to RunReveal via HTTP POST requests with proper JSON formatting and buffering for reliability.

**Batch Configuration Example**
```xml filename="batch-output.xml" copy
<match app.logs>
  @type http
  endpoint YOUR_WEBHOOK_URL
  http_method post
  headers {"Content-Type": "application/json"}
  <format>
    @type json
  </format>
  <buffer>
    @type memory
    flush_interval 10s
    chunk_limit_size 1m
    queue_limit_length 16
    retry_max_times 3
    retry_wait 1s
  </buffer>
</match>
```

Configures batch processing for optimal throughput and reduced network overhead.

**Multiple Outputs Example**
```xml filename="multiple-outputs.xml" copy
<match security.*>
  @type http
  endpoint YOUR_WEBHOOK_URL
  http_method post
  headers {"Content-Type": "application/json"}
  <format>
    @type json
  </format>
</match>

<match application.*>
  @type http
  endpoint YOUR_WEBHOOK_URL
  http_method post
  headers {"Content-Type": "application/json"}
  <format>
    @type json
  </format>
</match>
```

Routes different types of logs to separate endpoints for specialized processing.

  </Tabs.Tab>
</Tabs>

---

## Next Steps

Now that you have Fluentd configured and logs flowing to RunReveal, explore the detailed configuration guides:

- **[Detections](/detections)** - Create and manage security detection rules
- **[Sigma Streaming](/detections/sigma-streaming)** - Use Sigma rules for standardized threat detection
- **[Detection as Code](/detections/detection-as-code)** - Manage detections through code and version control
- **[Notifications](/notifications)** - Set up alerting and notification channels
- **[AI Chat](/ai-chat)** - Use AI-powered analysis for threat hunting and investigation
- **[Enrichments](/enrichments)** - Add context and metadata to your security events
- **[Filters](/filtering)** - Create custom filters to focus on specific security events

---

## Troubleshooting

### Common Issues

1. **Fluentd won't start**: Check the configuration syntax and file permissions
2. **No logs being sent**: Verify the log file paths exist and are readable
3. **Webhook errors**: Check that your webhook URL is correct and accessible
4. **Permission issues**: Ensure Fluentd has read access to your log files

### Debug Commands

```bash filename="debug-commands.sh" copy
# Check Fluentd status
sudo systemctl status td-agent

# View Fluentd logs
sudo journalctl -u td-agent -f

# Test webhook connectivity
curl -v YOUR_WEBHOOK_URL

# Test configuration syntax
fluentd -c fluentd.conf --dry-run

# Run Fluentd in debug mode
fluentd -c fluentd.conf -v
```

### Performance Tuning

<Callout type="info">
**Best Practices:**

1. **Buffer Management**: Configure appropriate buffer sizes for your log volume
2. **Batch Processing**: Adjust flush intervals to balance latency and throughput
3. **Memory Limits**: Set appropriate memory limits to prevent OOM issues
4. **Retry Logic**: Configure retry settings for failed webhook requests
5. **Monitoring**: Set up alerts for Fluentd service failures
</Callout>

---

## Resources

- [Fluentd Official Documentation](https://docs.fluentd.org/)
- [Fluentd Configuration Reference](https://docs.fluentd.org/configuration)
- [Fluentd Input Plugins](https://docs.fluentd.org/input)
- [Fluentd Filter Plugins](https://docs.fluentd.org/filter)
- [Fluentd Output Plugins](https://docs.fluentd.org/output)
- [Fluentd GitHub Repository](https://github.com/fluent/fluentd)
- [Fluentd Community](https://www.fluentd.org/community)