(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3932],{63915:function(e,n,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/sources/object-storage/external-s3",function(){return s(29906)}])},29906:function(e,n,s){"use strict";s.r(n),s.d(n,{default:function(){return d},useTOC:function(){return o}});var t=s(85893),r=s(37812),i=s(84854),a=s(79299),l={src:"/_next/static/media/external-s3-setup.728d1e53.png",height:567,width:1076,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAECAIAAAA8r+mnAAAASElEQVR42i2LQQ7AMAjD+P9vi8qgJWQrUyUfIsWWoeoeACL2GNMs1gJJmeZrA0WA+XN2FeVY53PfTUQm2uIrqmZPJKqj1m/xATxRXaF0Y5loAAAAAElFTkSuQmCC",blurWidth:8,blurHeight:4},c=s(95956);function o(e){return[{value:"AWS Access Methods",id:"aws-access-methods",depth:2},{value:"Custom IAM role",id:"custom-iam-role",depth:3},{value:"Creating the role",id:"creating-the-role",depth:4},{value:"Secure Access Using External ID",id:"secure-access-using-external-id",depth:4},{value:"AWS Access Key",id:"aws-access-key",depth:3},{value:"Event Notification",id:"event-notification",depth:2},{value:"RunReveal Source Setup",id:"runreveal-source-setup",depth:2},{value:"Final Steps",id:"final-steps",depth:2}]}var d=(0,r.c)(function(e){let{toc:n=o(e)}=e,s={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",span:"span",...(0,a.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.h1,{children:"AWS S3 Bucket with Custom SQS"}),"\n",(0,t.jsx)(s.p,{children:"An AWS S3 with custom SQS source works by saving logs to an S3 bucket and creating a put object notification that sends notifications to an SQS queue that you control.\nRunReveal will subscribe to this queue, read the event notifications, access the listed bucket object, and read events from it."}),"\n",(0,t.jsx)(s.p,{children:"This method is useful if you are already sending notifications to another SNS topic, adding your own SQS queue as a subscriber to that topic will allow you to fanout notifications to multiple subscribers."}),"\n",(0,t.jsx)(s.h2,{id:n[0].id,children:n[0].value}),"\n",(0,t.jsxs)(s.p,{children:["Along with an S3 bucket where your events are stored, you will also need to create an SQS queue that new object notifications are forwarded to.\nRunReveal will need to be given ",(0,t.jsx)(s.code,{children:"ListBucket"})," & ",(0,t.jsx)(s.code,{children:"GetObject"})," permissions on the S3 bucket(s) containing the logs and ",(0,t.jsx)(s.code,{children:"ReceiveMessage"})," and ",(0,t.jsx)(s.code,{children:"DeleteMessage"})," permissions on the SQS queue."]}),"\n",(0,t.jsx)(s.h3,{id:n[1].id,children:n[1].value}),"\n",(0,t.jsx)(s.p,{children:"S3 sources support reading via an IAM Role in your AWS account."}),"\n",(0,t.jsx)(s.p,{children:"At a high level you’ll need to create a role and provide that role access to the data you want RunReveal to ingest as well as the SQS queue that we should subscribe to."}),"\n",(0,t.jsx)(s.h4,{id:n[2].id,children:n[2].value}),"\n",(0,t.jsx)(s.p,{children:"When you create a source that supports AWS Role based access to the objects, you’ll be prompted to provide a role ARN.\nYour role will need to have at least the following permissions, one for reading objects in your S3 bucket and a second for receiving and deleting messages in your SQS queue."}),"\n",(0,t.jsx)(s.pre,{tabIndex:"0","data-language":"plaintext","data-word-wrap":"",children:(0,t.jsxs)(s.code,{children:[(0,t.jsx)(s.span,{children:(0,t.jsx)(s.span,{children:"{"})}),"\n",(0,t.jsx)(s.span,{children:(0,t.jsx)(s.span,{children:'    "Version": "2012-10-17",'})}),"\n",(0,t.jsx)(s.span,{children:(0,t.jsx)(s.span,{children:'    "Statement": ['})}),"\n",(0,t.jsx)(s.span,{children:(0,t.jsx)(s.span,{children:"        {"})}),"\n",(0,t.jsx)(s.span,{children:(0,t.jsx)(s.span,{children:'            "Action": ['})}),"\n",(0,t.jsx)(s.span,{children:(0,t.jsx)(s.span,{children:'                "s3:GetObject",'})}),"\n",(0,t.jsx)(s.span,{children:(0,t.jsx)(s.span,{children:'                "s3:ListBucket"'})}),"\n",(0,t.jsx)(s.span,{children:(0,t.jsx)(s.span,{children:"            ],"})}),"\n",(0,t.jsx)(s.span,{children:(0,t.jsx)(s.span,{children:'            "Resource": ['})}),"\n",(0,t.jsx)(s.span,{children:(0,t.jsx)(s.span,{children:'                "arn:aws:s3:::<bucket-name>",'})}),"\n",(0,t.jsx)(s.span,{children:(0,t.jsx)(s.span,{children:'                "arn:aws:s3:::<bucket-name>/*"'})}),"\n",(0,t.jsx)(s.span,{children:(0,t.jsx)(s.span,{children:"            ],"})}),"\n",(0,t.jsx)(s.span,{children:(0,t.jsx)(s.span,{children:'            "Effect": "Allow"'})}),"\n",(0,t.jsx)(s.span,{children:(0,t.jsx)(s.span,{children:"        },"})}),"\n",(0,t.jsx)(s.span,{children:(0,t.jsx)(s.span,{children:"        {"})}),"\n",(0,t.jsx)(s.span,{children:(0,t.jsx)(s.span,{children:'            "Effect": "Allow",'})}),"\n",(0,t.jsx)(s.span,{children:(0,t.jsx)(s.span,{children:'            "Action": ['})}),"\n",(0,t.jsx)(s.span,{children:(0,t.jsx)(s.span,{children:'                "sqs:DeleteMessage",'})}),"\n",(0,t.jsx)(s.span,{children:(0,t.jsx)(s.span,{children:'                "sqs:ReceiveMessage"'})}),"\n",(0,t.jsx)(s.span,{children:(0,t.jsx)(s.span,{children:"            ],"})}),"\n",(0,t.jsx)(s.span,{children:(0,t.jsx)(s.span,{children:'            "Resource": ['})}),"\n",(0,t.jsx)(s.span,{children:(0,t.jsx)(s.span,{children:'                "arn:aws:sqs:us-east-2:<account-id>:<sqs-queue-name>"'})}),"\n",(0,t.jsx)(s.span,{children:(0,t.jsx)(s.span,{children:"            ]"})}),"\n",(0,t.jsx)(s.span,{children:(0,t.jsx)(s.span,{children:"        },"})}),"\n",(0,t.jsx)(s.span,{children:(0,t.jsx)(s.span,{children:"        {"})}),"\n",(0,t.jsx)(s.span,{children:(0,t.jsx)(s.span,{children:'            "Action": ['})}),"\n",(0,t.jsx)(s.span,{children:(0,t.jsx)(s.span,{children:'                "kms:Decrypt"'})}),"\n",(0,t.jsx)(s.span,{children:(0,t.jsx)(s.span,{children:"            ],"})}),"\n",(0,t.jsx)(s.span,{children:(0,t.jsx)(s.span,{children:'            "Resource": ['})}),"\n",(0,t.jsx)(s.span,{children:(0,t.jsx)(s.span,{children:'                "arn:aws:kms:us-west-2:EXAMPLE_AWS_ACCOUNT:key/1234abcd-12ab-34cd-56ef-1234567890ab"'})}),"\n",(0,t.jsx)(s.span,{children:(0,t.jsx)(s.span,{children:"            ],"})}),"\n",(0,t.jsx)(s.span,{children:(0,t.jsx)(s.span,{children:'            "Effect": "Allow"'})}),"\n",(0,t.jsx)(s.span,{children:(0,t.jsx)(s.span,{children:"        }"})}),"\n",(0,t.jsx)(s.span,{children:(0,t.jsx)(s.span,{children:"    ]"})}),"\n",(0,t.jsx)(s.span,{children:(0,t.jsx)(s.span,{children:"}"})})]})}),"\n",(0,t.jsx)(c.U,{type:"info",children:(0,t.jsx)(s.p,{children:"If your bucket objects are encrypted with an AWS managed AWS key, you don’t need the KMS policy.\nIf it’s encrypted with a KMS key you created that lives in your account, you’ll need to include the KMS policy as well."})}),"\n",(0,t.jsx)(s.h4,{id:n[3].id,children:n[3].value}),"\n",(0,t.jsx)(s.p,{children:"The external ID configuration helps prevent the confused deputy problem.\nThe trusted entities configuration necessary for RunReveal to access your account looks like this.\nMake sure you fill in the external ID with whatever you set up on your source."}),"\n",(0,t.jsx)(s.pre,{tabIndex:"0","data-language":"plaintext","data-word-wrap":"",children:(0,t.jsxs)(s.code,{children:[(0,t.jsx)(s.span,{children:(0,t.jsx)(s.span,{children:"{"})}),"\n",(0,t.jsx)(s.span,{children:(0,t.jsx)(s.span,{children:'    "Version": "2012-10-17",'})}),"\n",(0,t.jsx)(s.span,{children:(0,t.jsx)(s.span,{children:'    "Statement": ['})}),"\n",(0,t.jsx)(s.span,{children:(0,t.jsx)(s.span,{children:"        {"})}),"\n",(0,t.jsx)(s.span,{children:(0,t.jsx)(s.span,{children:'            "Effect": "Allow",'})}),"\n",(0,t.jsx)(s.span,{children:(0,t.jsx)(s.span,{children:'            "Principal": {'})}),"\n",(0,t.jsx)(s.span,{children:(0,t.jsx)(s.span,{children:'                "AWS": "arn:aws:iam::253602268883:root"'})}),"\n",(0,t.jsx)(s.span,{children:(0,t.jsx)(s.span,{children:"            },"})}),"\n",(0,t.jsx)(s.span,{children:(0,t.jsx)(s.span,{children:'            "Action": "sts:AssumeRole",'})}),"\n",(0,t.jsx)(s.span,{children:(0,t.jsx)(s.span,{children:'            "Condition": {'})}),"\n",(0,t.jsx)(s.span,{children:(0,t.jsx)(s.span,{children:'                "StringEquals": {'})}),"\n",(0,t.jsx)(s.span,{children:(0,t.jsx)(s.span,{children:'                    "sts:ExternalId": "<EXTERNAL_ID>"'})}),"\n",(0,t.jsx)(s.span,{children:(0,t.jsx)(s.span,{children:"                }"})}),"\n",(0,t.jsx)(s.span,{children:(0,t.jsx)(s.span,{children:"            }"})}),"\n",(0,t.jsx)(s.span,{children:(0,t.jsx)(s.span,{children:"        }"})}),"\n",(0,t.jsx)(s.span,{children:(0,t.jsx)(s.span,{children:"    ]"})}),"\n",(0,t.jsx)(s.span,{children:(0,t.jsx)(s.span,{children:"}"})})]})}),"\n",(0,t.jsx)(s.h3,{id:n[4].id,children:n[4].value}),"\n",(0,t.jsx)(s.p,{children:"Give an AWS user access to Read/List the S3 bucket with your logs in it. Generate a new AWS access key and provide RunReveal with the access key id and secret."}),"\n",(0,t.jsx)(s.p,{children:"RunReveal will use the provided access key to authenticate access to your AWS account when reading S3 objects."}),"\n",(0,t.jsx)(s.h2,{id:n[5].id,children:n[5].value}),"\n",(0,t.jsx)(s.p,{children:"Once RunReveal has access to the objects in your bucket and SQS queue, the queue will need to be notified when new objects are stored.\nEnable sending notifications to your SQS queue either by sending to an SNS topic or directly to the queue."}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsx)(s.li,{children:"Find the bucket containing the logs you wish to send to RunReveal."}),"\n",(0,t.jsx)(s.li,{children:"From the bucket overview, click the “Properties” tab, then scroll down to “Event Notifications”"}),"\n",(0,t.jsx)(s.li,{children:"Click “Create Event Notification”"}),"\n",(0,t.jsx)(s.li,{children:"Give the configuration a name (for your own identifying purposes, doesn’t matter what it is)."}),"\n",(0,t.jsx)(s.li,{children:"Select “All object create events” in the events section (photo below)"}),"\n"]}),"\n",(0,t.jsx)("img",{src:"/s3-role-2.png"}),"\n",(0,t.jsxs)(s.ol,{start:"6",children:["\n",(0,t.jsx)(s.li,{children:"Then input the arn of the SQS queue or SNS topic that notifications will be sent to."}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:n[6].id,children:n[6].value}),"\n",(0,t.jsxs)(s.p,{children:["Sources that allow you to use S3 to ingest logs will all have the same setup.\nNavigate to the ",(0,t.jsx)(s.a,{href:"https://app.runreveal.com/dash/sources/add",children:"Connect a source"})," page and find the source you are adding.\nOnce open, select the ",(0,t.jsx)(s.code,{children:"AWS S3 Bucket with custom SQS"})," ingest method and fill in the fields."]}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"external s3 setup",placeholder:"blur",src:l})}),"\n",(0,t.jsx)(s.p,{children:"You will need the URL of the SQS queue that events are sent to and the region the queue was created in.\nDepending on the authentication method selected supply the necessary role/external id or access key/secret."}),"\n",(0,t.jsx)(s.h2,{id:n[7].id,children:n[7].value}),"\n",(0,t.jsx)(s.p,{children:"At this point all of the pieces are in place for RunReveal to access logs stored in the bucket.\nContinue to the source docs for specific instructions on how to get your logs into the S3 bucket."})]})},"/sources/object-storage/external-s3",{filePath:"pages/sources/object-storage/external-s3.mdx",timestamp:1750451516e3,pageMap:i.v,frontMatter:{title:"External S3",description:"Configure AWS S3 with custom SQS queue for log ingestion in RunReveal. Set up IAM roles, SQS permissions, and external queue management for automated log processing."},title:"External S3"},"undefined"==typeof RemoteContent?o:RemoteContent.useTOC)},95956:function(e,n,s){"use strict";s.d(n,{U:function(){return c}});var t=s(85893),r=s(90512),i=s(45192);let a={default:"\uD83D\uDCA1",error:"\uD83D\uDEAB",info:(0,t.jsx)(i.AV,{className:"_mt-1"}),warning:"⚠️"},l={default:(0,r.Z)("_border-orange-100 _bg-orange-50 _text-orange-800 dark:_border-orange-400/30 dark:_bg-orange-400/20 dark:_text-orange-300"),error:(0,r.Z)("_border-red-200 _bg-red-100 _text-red-900 dark:_border-red-200/30 dark:_bg-red-900/30 dark:_text-red-200"),info:(0,r.Z)("_border-blue-200 _bg-blue-100 _text-blue-900 dark:_border-blue-200/30 dark:_bg-blue-900/30 dark:_text-blue-200"),warning:(0,r.Z)("_border-yellow-100 _bg-yellow-50 _text-yellow-900 dark:_border-yellow-200/30 dark:_bg-yellow-700/30 dark:_text-yellow-200")};function c({children:e,type:n="default",emoji:s=a[n]}){return(0,t.jsxs)("div",{className:(0,r.Z)("nextra-callout _overflow-x-auto _mt-6 _flex _rounded-lg _border _py-2 ltr:_pr-4 rtl:_pl-4","contrast-more:_border-current contrast-more:dark:_border-current",l[n]),children:[(0,t.jsx)("div",{className:"_select-none _text-xl ltr:_pl-3 ltr:_pr-2 rtl:_pr-3 rtl:_pl-2",style:{fontFamily:'"Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"'},children:s}),(0,t.jsx)("div",{className:"_w-full _min-w-0 _leading-7",children:e})]})}}},function(e){e.O(0,[7812,4854,2888,9774,179],function(){return e(e.s=63915)}),_N_E=e.O()}]);