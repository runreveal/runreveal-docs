(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[100],{49635:function(e,s,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/sources/object-storage/s3",function(){return i(8477)}])},8477:function(e,s,i){"use strict";i.r(s),i.d(s,{useTOC:function(){return h}});var n=i(85893),r=i(37812),l=i(84854),t=i(79299),a=i(95956);function h(e){return[{value:"AWS Access Methods",id:"aws-access-methods",depth:2},{value:"RunReveal allow policy",id:"runreveal-allow-policy",depth:3},{value:"Custom IAM role",id:"custom-iam-role",depth:3},{value:"Creating the role",id:"creating-the-role",depth:4},{value:"Secure Access Using External ID",id:"secure-access-using-external-id",depth:4},{value:"AWS Access Key",id:"aws-access-key",depth:3},{value:"Event Notification",id:"event-notification",depth:2},{value:"RunReveal Source Setup",id:"runreveal-source-setup",depth:2},{value:"Final Steps",id:"final-steps",depth:2},{value:"Datalake Architecture with Single S3 Bucket",id:"datalake-architecture-with-single-s3-bucket",depth:2},{value:"Architecture Overview",id:"architecture-overview",depth:3},{value:"Setup Steps",id:"setup-steps",depth:3},{value:"1. Create SQS Queues",id:"1-create-sqs-queues",depth:4},{value:"2. Configure SQS Queue Policy",id:"2-configure-sqs-queue-policy",depth:4},{value:"3. Configure S3 Event Notifications",id:"3-configure-s3-event-notifications",depth:4},{value:"4. Configure RunReveal Sources",id:"4-configure-runreveal-sources",depth:4},{value:"Benefits",id:"benefits",depth:3},{value:"Example Directory Structure",id:"example-directory-structure",depth:3},{value:"Troubleshooting",id:"troubleshooting",depth:2},{value:"”An error occurred communicating with RunReveal, please try again” in the UI error when adding a new source.",id:"an-error-occurred-communicating-with-runreveal-please-try-again-in-the-ui-error-when-adding-a-new-source",depth:3},{value:"Access Denied (403) Error in UI when trying to verify settings (bucket permissions)",id:"access-denied-403-error-in-ui-when-trying-to-verify-settings-bucket-permissions",depth:3},{value:"No Data Ingested from s3 bucket for a source",id:"no-data-ingested-from-s3-bucket-for-a-source",depth:3}]}s.default=(0,r.c)(function(e){let{toc:s=h(e)}=e,i={a:"a",br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",span:"span",strong:"strong",ul:"ul",...(0,t.a)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(i.h1,{children:"AWS S3 Bucket"}),"\n",(0,n.jsx)(i.p,{children:"An AWS S3 source works by saving logs to an S3 bucket and creating a put object notification that sends notifications to an SNS topic that RunReveal controls.\nEach source has its own SNS topic that includes one for multiple different regions, reference the specific source documentation for the exact SNS topic to send to."}),"\n",(0,n.jsx)(i.p,{children:"Once we receive this notification, RunReveal will download the S3 object and process the events."}),"\n",(0,n.jsx)(i.h2,{id:s[0].id,children:s[0].value}),"\n",(0,n.jsx)(i.p,{children:"When using the RunReveal controlled SNS topic we offer three separate authentication methods."}),"\n",(0,n.jsx)(i.h3,{id:s[1].id,children:s[1].value}),"\n",(0,n.jsx)(i.p,{children:"Provide RunReveal IAM role access to read/list objects in your S3 bucket. Use the following policy to give access."}),"\n",(0,n.jsx)(i.pre,{tabIndex:"0","data-language":"json","data-word-wrap":"",children:(0,n.jsxs)(i.code,{children:[(0,n.jsx)(i.span,{children:(0,n.jsx)(i.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:"{"})}),"\n",(0,n.jsxs)(i.span,{children:[(0,n.jsx)(i.span,{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"},children:'  "Version"'}),(0,n.jsx)(i.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:": "}),(0,n.jsx)(i.span,{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},children:'"2012-10-17"'}),(0,n.jsx)(i.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:","})]}),"\n",(0,n.jsxs)(i.span,{children:[(0,n.jsx)(i.span,{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"},children:'  "Statement"'}),(0,n.jsx)(i.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:": ["})]}),"\n",(0,n.jsx)(i.span,{children:(0,n.jsx)(i.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:"    {"})}),"\n",(0,n.jsxs)(i.span,{children:[(0,n.jsx)(i.span,{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"},children:'      "Sid"'}),(0,n.jsx)(i.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:": "}),(0,n.jsx)(i.span,{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},children:'"Allow-RunReveal-Read"'}),(0,n.jsx)(i.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:","})]}),"\n",(0,n.jsxs)(i.span,{children:[(0,n.jsx)(i.span,{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"},children:'      "Effect"'}),(0,n.jsx)(i.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:": "}),(0,n.jsx)(i.span,{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},children:'"Allow"'}),(0,n.jsx)(i.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:","})]}),"\n",(0,n.jsxs)(i.span,{children:[(0,n.jsx)(i.span,{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"},children:'      "Principal"'}),(0,n.jsx)(i.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:": {"})]}),"\n",(0,n.jsxs)(i.span,{children:[(0,n.jsx)(i.span,{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"},children:'        "AWS"'}),(0,n.jsx)(i.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:": "}),(0,n.jsx)(i.span,{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},children:'"arn:aws:iam::253602268883:root"'})]}),"\n",(0,n.jsx)(i.span,{children:(0,n.jsx)(i.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:"      },"})}),"\n",(0,n.jsxs)(i.span,{children:[(0,n.jsx)(i.span,{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"},children:'      "Action"'}),(0,n.jsx)(i.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:": ["})]}),"\n",(0,n.jsxs)(i.span,{children:[(0,n.jsx)(i.span,{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},children:'        "s3:GetObject"'}),(0,n.jsx)(i.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:","})]}),"\n",(0,n.jsx)(i.span,{children:(0,n.jsx)(i.span,{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},children:'        "s3:ListBucket"'})}),"\n",(0,n.jsx)(i.span,{children:(0,n.jsx)(i.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:"      ],"})}),"\n",(0,n.jsxs)(i.span,{children:[(0,n.jsx)(i.span,{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"},children:'      "Resource"'}),(0,n.jsx)(i.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:": ["})]}),"\n",(0,n.jsxs)(i.span,{children:[(0,n.jsx)(i.span,{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},children:'        "arn:aws:s3:::YOUR_BUCKET_NAME/*"'}),(0,n.jsx)(i.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:","})]}),"\n",(0,n.jsx)(i.span,{children:(0,n.jsx)(i.span,{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},children:'        "arn:aws:s3:::YOUR_BUCKET_NAME"'})}),"\n",(0,n.jsx)(i.span,{children:(0,n.jsx)(i.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:"      ]"})}),"\n",(0,n.jsx)(i.span,{children:(0,n.jsx)(i.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:"    }"})}),"\n",(0,n.jsx)(i.span,{children:(0,n.jsx)(i.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:"  ]"})}),"\n",(0,n.jsx)(i.span,{children:(0,n.jsx)(i.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:"}"})})]})}),"\n",(0,n.jsx)(i.h3,{id:s[2].id,children:s[2].value}),"\n",(0,n.jsx)(i.p,{children:"S3 sources support reading via an IAM Role in your AWS account. This is so you don’t need to worry about fiddling with a bucket policy each time you onboard a new log source."}),"\n",(0,n.jsx)(i.p,{children:"At a high level you’ll need to create a role and provide that role access to the data you want RunReveal to ingest."}),"\n",(0,n.jsx)(i.h4,{id:s[3].id,children:s[3].value}),"\n",(0,n.jsx)(i.p,{children:"When creating the role, you’ll need to provide us with S3 and KMS permissions necessary to read objects from the bucket, and decrypt them."}),"\n",(0,n.jsxs)(i.p,{children:["When you create a source that supports AWS Role based access to the objects, you’ll be prompted to provide a role ARN. Your role needs to have ",(0,n.jsx)(i.code,{children:"s3:GetObject"}),", ",(0,n.jsx)(i.code,{children:"s3:ListBucket"}),", and access to the ",(0,n.jsx)(i.code,{children:"Resources"})," that are contained in your bucket."]}),"\n",(0,n.jsx)(i.pre,{tabIndex:"0","data-language":"plaintext","data-word-wrap":"",children:(0,n.jsxs)(i.code,{children:[(0,n.jsx)(i.span,{children:(0,n.jsx)(i.span,{children:"{"})}),"\n",(0,n.jsx)(i.span,{children:(0,n.jsx)(i.span,{children:'    "Version": "2012-10-17",'})}),"\n",(0,n.jsx)(i.span,{children:(0,n.jsx)(i.span,{children:'    "Statement": ['})}),"\n",(0,n.jsx)(i.span,{children:(0,n.jsx)(i.span,{children:"        {"})}),"\n",(0,n.jsx)(i.span,{children:(0,n.jsx)(i.span,{children:'            "Action": ['})}),"\n",(0,n.jsx)(i.span,{children:(0,n.jsx)(i.span,{children:'                "s3:GetObject",'})}),"\n",(0,n.jsx)(i.span,{children:(0,n.jsx)(i.span,{children:'                "s3:ListBucket"'})}),"\n",(0,n.jsx)(i.span,{children:(0,n.jsx)(i.span,{children:"            ],"})}),"\n",(0,n.jsx)(i.span,{children:(0,n.jsx)(i.span,{children:'            "Resource": ['})}),"\n",(0,n.jsx)(i.span,{children:(0,n.jsx)(i.span,{children:'                "arn:aws:s3:::<YOUR_BUCKET>",'})}),"\n",(0,n.jsx)(i.span,{children:(0,n.jsx)(i.span,{children:'                "arn:aws:s3:::<YOUR_BUCKET>/*"'})}),"\n",(0,n.jsx)(i.span,{children:(0,n.jsx)(i.span,{children:"            ],"})}),"\n",(0,n.jsx)(i.span,{children:(0,n.jsx)(i.span,{children:'            "Effect": "Allow"'})}),"\n",(0,n.jsx)(i.span,{children:(0,n.jsx)(i.span,{children:"        },"})}),"\n",(0,n.jsx)(i.span,{children:(0,n.jsx)(i.span,{children:"        {"})}),"\n",(0,n.jsx)(i.span,{children:(0,n.jsx)(i.span,{children:'            "Action": ['})}),"\n",(0,n.jsx)(i.span,{children:(0,n.jsx)(i.span,{children:'                "kms:Decrypt"'})}),"\n",(0,n.jsx)(i.span,{children:(0,n.jsx)(i.span,{children:"            ],"})}),"\n",(0,n.jsx)(i.span,{children:(0,n.jsx)(i.span,{children:'            "Resource": ['})}),"\n",(0,n.jsx)(i.span,{children:(0,n.jsx)(i.span,{children:'                "arn:aws:kms:us-west-2:EXAMPLE_AWS_ACCOUNT:key/1234abcd-12ab-34cd-56ef-1234567890ab"'})}),"\n",(0,n.jsx)(i.span,{children:(0,n.jsx)(i.span,{children:"            ],"})}),"\n",(0,n.jsx)(i.span,{children:(0,n.jsx)(i.span,{children:'            "Effect": "Allow"'})}),"\n",(0,n.jsx)(i.span,{children:(0,n.jsx)(i.span,{children:"        }"})}),"\n",(0,n.jsx)(i.span,{children:(0,n.jsx)(i.span,{children:"    ]"})}),"\n",(0,n.jsx)(i.span,{children:(0,n.jsx)(i.span,{children:"}"})})]})}),"\n",(0,n.jsx)(a.U,{type:"info",children:(0,n.jsx)(i.p,{children:"If your bucket objects are encrypted with an AWS managed AWS key, you don’t need the KMS policy.\nIf it’s encrypted with a KMS key you created that lives in your account, you’ll need to include the KMS policy as well."})}),"\n",(0,n.jsx)(i.h4,{id:s[4].id,children:s[4].value}),"\n",(0,n.jsx)(i.p,{children:"The external ID configuration helps prevent the confused deputy problem.\nThe trusted entities configuration necessary for RunReveal to access your account looks like this.\nMake sure you fill in the external ID with whatever you set up on your source."}),"\n",(0,n.jsx)(i.pre,{tabIndex:"0","data-language":"plaintext","data-word-wrap":"",children:(0,n.jsxs)(i.code,{children:[(0,n.jsx)(i.span,{children:(0,n.jsx)(i.span,{children:"{"})}),"\n",(0,n.jsx)(i.span,{children:(0,n.jsx)(i.span,{children:'    "Version": "2012-10-17",'})}),"\n",(0,n.jsx)(i.span,{children:(0,n.jsx)(i.span,{children:'    "Statement": ['})}),"\n",(0,n.jsx)(i.span,{children:(0,n.jsx)(i.span,{children:"        {"})}),"\n",(0,n.jsx)(i.span,{children:(0,n.jsx)(i.span,{children:'            "Effect": "Allow",'})}),"\n",(0,n.jsx)(i.span,{children:(0,n.jsx)(i.span,{children:'            "Principal": {'})}),"\n",(0,n.jsx)(i.span,{children:(0,n.jsx)(i.span,{children:'                "AWS": "arn:aws:iam::253602268883:root"'})}),"\n",(0,n.jsx)(i.span,{children:(0,n.jsx)(i.span,{children:"            },"})}),"\n",(0,n.jsx)(i.span,{children:(0,n.jsx)(i.span,{children:'            "Action": "sts:AssumeRole",'})}),"\n",(0,n.jsx)(i.span,{children:(0,n.jsx)(i.span,{children:'            "Condition": {'})}),"\n",(0,n.jsx)(i.span,{children:(0,n.jsx)(i.span,{children:'                "StringEquals": {'})}),"\n",(0,n.jsx)(i.span,{children:(0,n.jsx)(i.span,{children:'                    "sts:ExternalId": "<EXTERNAL_ID>"'})}),"\n",(0,n.jsx)(i.span,{children:(0,n.jsx)(i.span,{children:"                }"})}),"\n",(0,n.jsx)(i.span,{children:(0,n.jsx)(i.span,{children:"            }"})}),"\n",(0,n.jsx)(i.span,{children:(0,n.jsx)(i.span,{children:"        }"})}),"\n",(0,n.jsx)(i.span,{children:(0,n.jsx)(i.span,{children:"    ]"})}),"\n",(0,n.jsx)(i.span,{children:(0,n.jsx)(i.span,{children:"}"})})]})}),"\n",(0,n.jsx)(i.h3,{id:s[5].id,children:s[5].value}),"\n",(0,n.jsx)(i.p,{children:"Give an AWS user access to Read/List the S3 bucket with your logs in it. Generate a new AWS access key and provide RunReveal with the access key id and secret."}),"\n",(0,n.jsx)(i.p,{children:"RunReveal will use the provided access key to authenticate access to your AWS account when reading S3 objects."}),"\n",(0,n.jsx)(i.h2,{id:s[6].id,children:s[6].value}),"\n",(0,n.jsx)(i.p,{children:"Once RunReveal has access to the objects in your bucket, we will need to be notified when new objects are added to it.\nEnable sending notifications to one of RunReveal’s regional SNS topics by following along below."}),"\n",(0,n.jsxs)(i.ol,{children:["\n",(0,n.jsx)(i.li,{children:"Find the bucket containing the logs you wish to send to RunReveal."}),"\n",(0,n.jsx)(i.li,{children:"From the bucket overview, click the “Properties” tab, then scroll down to “Event Notifications”"}),"\n",(0,n.jsx)(i.li,{children:"Click “Create Event Notification”"}),"\n",(0,n.jsx)(i.li,{children:"Give the configuration a name (for your own identifying purposes, doesn’t matter what it is)."}),"\n",(0,n.jsx)(i.li,{children:"Select “All object create events” in the events section (photo below)"}),"\n"]}),"\n",(0,n.jsx)("img",{src:"/s3-role-2.png"}),"\n",(0,n.jsxs)(i.ol,{start:"6",children:["\n",(0,n.jsxs)(i.li,{children:["Then input RunReveal’s S3 regional SNS topic ARN (",(0,n.jsx)(i.code,{children:"arn:aws:sns:<s3-bucket-region>:253602268883:runreveal_<sourcetype>"}),") under the “Destinations” block at the bottom like so.",(0,n.jsx)(i.br,{}),"\n","We’ve created a SNS topic in each region, 1 for each source type. If you run into issues, please contact us at ",(0,n.jsx)(i.code,{children:"support@runreveal.com"}),". "]}),"\n"]}),"\n",(0,n.jsx)(a.U,{type:"info",children:(0,n.jsx)(i.p,{children:"For the exact SNS topic to use reference the documentation for that source."})}),"\n",(0,n.jsx)(i.h2,{id:s[7].id,children:s[7].value}),"\n",(0,n.jsxs)(i.p,{children:["Sources that allow you to use S3 to ingest logs will all have the same setup.\nNavigate to the ",(0,n.jsx)(i.a,{href:"https://app.runreveal.com/dash/sources/add",children:"Connect a source"})," page and find the source you are adding.\nOnce open, select the ",(0,n.jsx)(i.code,{children:"AWS S3 Bucket"})," ingest method and fill in the fields."]}),"\n",(0,n.jsx)(i.p,{children:"You will need the name of the bucket that the logs are stored in, currently RunReveal requires buckets to be unique across sources.\nDepending on the authentication method selected supply the necessary role/external id, or access key/secret."}),"\n",(0,n.jsx)(i.h2,{id:s[8].id,children:s[8].value}),"\n",(0,n.jsx)(i.p,{children:"At this point all of the pieces are in place for RunReveal to access logs stored in the bucket.\nContinue to the source docs for specific instructions on how to get your logs into the S3 bucket and the specific SNS topic to use."}),"\n",(0,n.jsx)(i.h2,{id:s[9].id,children:s[9].value}),"\n",(0,n.jsx)(i.p,{children:"For organizations using a datalake architecture, you can configure a single S3 bucket to handle multiple source types by using SQS queues and S3 event notifications with prefixes. This approach allows you to centralize your log storage while maintaining separate processing pipelines for different source types."}),"\n",(0,n.jsx)(i.h3,{id:s[10].id,children:s[10].value}),"\n",(0,n.jsx)(i.p,{children:"Instead of using RunReveal’s SNS topics, this setup uses:"}),"\n",(0,n.jsxs)(i.ol,{children:["\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.strong,{children:"SQS queues"})," - One per source type in your AWS account"]}),"\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.strong,{children:"S3 event notifications"})," - Configured with prefixes to route to specific queues"]}),"\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.strong,{children:"RunReveal sources"})," - Connected to individual SQS queues"]}),"\n"]}),"\n",(0,n.jsx)(i.h3,{id:s[11].id,children:s[11].value}),"\n",(0,n.jsx)(i.h4,{id:s[12].id,children:s[12].value}),"\n",(0,n.jsx)(i.p,{children:"Create a separate SQS queue for each source type you want to ingest. For example:"}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsx)(i.li,{children:(0,n.jsx)(i.code,{children:"runreveal-cloudtrail-queue"})}),"\n",(0,n.jsx)(i.li,{children:(0,n.jsx)(i.code,{children:"runreveal-alb-queue"})}),"\n",(0,n.jsx)(i.li,{children:(0,n.jsx)(i.code,{children:"runreveal-vpc-flow-queue"})}),"\n"]}),"\n",(0,n.jsx)(i.h4,{id:s[13].id,children:s[13].value}),"\n",(0,n.jsx)(i.p,{children:"Each SQS queue needs a policy that allows S3 to publish notifications. Use the following policy template:"}),"\n",(0,n.jsx)(i.pre,{tabIndex:"0","data-language":"json","data-word-wrap":"",children:(0,n.jsxs)(i.code,{children:[(0,n.jsx)(i.span,{children:(0,n.jsx)(i.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:"{"})}),"\n",(0,n.jsxs)(i.span,{children:[(0,n.jsx)(i.span,{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"},children:'  "Version"'}),(0,n.jsx)(i.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:": "}),(0,n.jsx)(i.span,{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},children:'"2012-10-17"'}),(0,n.jsx)(i.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:","})]}),"\n",(0,n.jsxs)(i.span,{children:[(0,n.jsx)(i.span,{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"},children:'  "Id"'}),(0,n.jsx)(i.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:": "}),(0,n.jsx)(i.span,{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},children:'"__default_policy_ID"'}),(0,n.jsx)(i.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:","})]}),"\n",(0,n.jsxs)(i.span,{children:[(0,n.jsx)(i.span,{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"},children:'  "Statement"'}),(0,n.jsx)(i.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:": ["})]}),"\n",(0,n.jsx)(i.span,{children:(0,n.jsx)(i.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:"    {"})}),"\n",(0,n.jsxs)(i.span,{children:[(0,n.jsx)(i.span,{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"},children:'      "Sid"'}),(0,n.jsx)(i.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:": "}),(0,n.jsx)(i.span,{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},children:'"__owner_statement"'}),(0,n.jsx)(i.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:","})]}),"\n",(0,n.jsxs)(i.span,{children:[(0,n.jsx)(i.span,{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"},children:'      "Effect"'}),(0,n.jsx)(i.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:": "}),(0,n.jsx)(i.span,{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},children:'"Allow"'}),(0,n.jsx)(i.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:","})]}),"\n",(0,n.jsxs)(i.span,{children:[(0,n.jsx)(i.span,{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"},children:'      "Principal"'}),(0,n.jsx)(i.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:": {"})]}),"\n",(0,n.jsxs)(i.span,{children:[(0,n.jsx)(i.span,{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"},children:'        "AWS"'}),(0,n.jsx)(i.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:": "}),(0,n.jsx)(i.span,{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},children:'"arn:aws:iam::<Account_id>:root"'})]}),"\n",(0,n.jsx)(i.span,{children:(0,n.jsx)(i.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:"      },"})}),"\n",(0,n.jsxs)(i.span,{children:[(0,n.jsx)(i.span,{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"},children:'      "Action"'}),(0,n.jsx)(i.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:": "}),(0,n.jsx)(i.span,{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},children:'"SQS:*"'}),(0,n.jsx)(i.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:","})]}),"\n",(0,n.jsxs)(i.span,{children:[(0,n.jsx)(i.span,{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"},children:'      "Resource"'}),(0,n.jsx)(i.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:": "}),(0,n.jsx)(i.span,{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},children:'"arn:aws:sqs:us-east-2:<Account_id>:<queue_name>"'})]}),"\n",(0,n.jsx)(i.span,{children:(0,n.jsx)(i.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:"    },"})}),"\n",(0,n.jsx)(i.span,{children:(0,n.jsx)(i.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:"    {"})}),"\n",(0,n.jsxs)(i.span,{children:[(0,n.jsx)(i.span,{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"},children:'      "Sid"'}),(0,n.jsx)(i.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:": "}),(0,n.jsx)(i.span,{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},children:'"Allow S3 to publish to SQS"'}),(0,n.jsx)(i.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:","})]}),"\n",(0,n.jsxs)(i.span,{children:[(0,n.jsx)(i.span,{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"},children:'      "Effect"'}),(0,n.jsx)(i.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:": "}),(0,n.jsx)(i.span,{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},children:'"Allow"'}),(0,n.jsx)(i.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:","})]}),"\n",(0,n.jsxs)(i.span,{children:[(0,n.jsx)(i.span,{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"},children:'      "Principal"'}),(0,n.jsx)(i.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:": {"})]}),"\n",(0,n.jsxs)(i.span,{children:[(0,n.jsx)(i.span,{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"},children:'        "Service"'}),(0,n.jsx)(i.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:": "}),(0,n.jsx)(i.span,{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},children:'"s3.amazonaws.com"'})]}),"\n",(0,n.jsx)(i.span,{children:(0,n.jsx)(i.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:"      },"})}),"\n",(0,n.jsxs)(i.span,{children:[(0,n.jsx)(i.span,{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"},children:'      "Action"'}),(0,n.jsx)(i.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:": "}),(0,n.jsx)(i.span,{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},children:'"SQS:*"'}),(0,n.jsx)(i.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:","})]}),"\n",(0,n.jsxs)(i.span,{children:[(0,n.jsx)(i.span,{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"},children:'      "Resource"'}),(0,n.jsx)(i.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:": "}),(0,n.jsx)(i.span,{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},children:'"*"'})]}),"\n",(0,n.jsx)(i.span,{children:(0,n.jsx)(i.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:"    }"})}),"\n",(0,n.jsx)(i.span,{children:(0,n.jsx)(i.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:"  ]"})}),"\n",(0,n.jsx)(i.span,{children:(0,n.jsx)(i.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:"}"})})]})}),"\n",(0,n.jsx)(a.U,{type:"warning",children:(0,n.jsxs)(i.p,{children:["Replace ",(0,n.jsx)(i.code,{children:"<Account_id>"})," with your AWS account ID and update the SQS queue ARN in the resource field to match your queue."]})}),"\n",(0,n.jsx)(i.h4,{id:s[14].id,children:s[14].value}),"\n",(0,n.jsx)(i.p,{children:"Set up event notifications in your S3 bucket with prefixes to route logs to the appropriate SQS queues:"}),"\n",(0,n.jsx)(i.p,{children:(0,n.jsx)(i.strong,{children:"For CloudTrail logs:"})}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsxs)(i.li,{children:["Prefix: ",(0,n.jsx)(i.code,{children:"AWSLogs/<account_id>/CloudTrail/"})]}),"\n",(0,n.jsx)(i.li,{children:"Destination: Your CloudTrail SQS queue"}),"\n"]}),"\n",(0,n.jsx)(i.p,{children:(0,n.jsx)(i.strong,{children:"For Application Load Balancer logs:"})}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsxs)(i.li,{children:["Prefix: ",(0,n.jsx)(i.code,{children:"AWSLogs/<account_id>/elasticloadbalancing/"})]}),"\n",(0,n.jsx)(i.li,{children:"Destination: Your ALB SQS queue"}),"\n"]}),"\n",(0,n.jsx)(i.p,{children:(0,n.jsx)(i.strong,{children:"For VPC Flow logs:"})}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsxs)(i.li,{children:["Prefix: ",(0,n.jsx)(i.code,{children:"AWSLogs/<account_id>/vpcflowlogs/"})]}),"\n",(0,n.jsx)(i.li,{children:"Destination: Your VPC Flow SQS queue"}),"\n"]}),"\n",(0,n.jsx)(i.h4,{id:s[15].id,children:s[15].value}),"\n",(0,n.jsx)(i.p,{children:"When creating sources in RunReveal:"}),"\n",(0,n.jsxs)(i.ol,{children:["\n",(0,n.jsx)(i.li,{children:"Select the appropriate source type (CloudTrail, ALB, VPC Flow, etc.)"}),"\n",(0,n.jsx)(i.li,{children:"Choose the SQS ingest method instead of S3"}),"\n",(0,n.jsx)(i.li,{children:"Provide the SQS queue ARN for that specific source type"}),"\n",(0,n.jsx)(i.li,{children:"Configure the necessary IAM permissions for RunReveal to read from the SQS queue"}),"\n"]}),"\n",(0,n.jsx)(i.h3,{id:s[16].id,children:s[16].value}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.strong,{children:"Centralized storage"}),": All logs in one S3 bucket"]}),"\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.strong,{children:"Organized structure"}),": Prefix-based routing keeps logs organized"]}),"\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.strong,{children:"Scalable"}),": Easy to add new source types"]}),"\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.strong,{children:"Cost-effective"}),": Single bucket reduces storage costs"]}),"\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.strong,{children:"Flexible"}),": Independent processing pipelines per source type"]}),"\n"]}),"\n",(0,n.jsx)(i.h3,{id:s[17].id,children:s[17].value}),"\n",(0,n.jsx)(i.pre,{tabIndex:"0","data-language":"plaintext","data-word-wrap":"",children:(0,n.jsxs)(i.code,{children:[(0,n.jsx)(i.span,{children:(0,n.jsx)(i.span,{children:"s3://your-datalake-bucket/"})}),"\n",(0,n.jsx)(i.span,{children:(0,n.jsx)(i.span,{children:"├── AWSLogs/"})}),"\n",(0,n.jsx)(i.span,{children:(0,n.jsx)(i.span,{children:"│   ├── 123456789012/"})}),"\n",(0,n.jsx)(i.span,{children:(0,n.jsx)(i.span,{children:"│   │   ├── CloudTrail/"})}),"\n",(0,n.jsx)(i.span,{children:(0,n.jsx)(i.span,{children:"│   │   │   └── us-east-1/"})}),"\n",(0,n.jsx)(i.span,{children:(0,n.jsx)(i.span,{children:"│   │   ├── elasticloadbalancing/"})}),"\n",(0,n.jsx)(i.span,{children:(0,n.jsx)(i.span,{children:"│   │   └── vpcflowlogs/"})}),"\n",(0,n.jsx)(i.span,{children:(0,n.jsx)(i.span,{children:"│   │       └── us-east-1/"})}),"\n",(0,n.jsx)(i.span,{children:(0,n.jsx)(i.span,{children:"│   │           └── 2024/"})}),"\n",(0,n.jsx)(i.span,{children:(0,n.jsx)(i.span,{children:"│   │               └── 01/"})}),"\n",(0,n.jsx)(i.span,{children:(0,n.jsx)(i.span,{children:"│   │                   └── 15/"})}),"\n",(0,n.jsx)(i.span,{children:(0,n.jsx)(i.span,{children:"│   │                       └── eni-12345678_..."})})]})}),"\n",(0,n.jsx)(i.h2,{id:s[18].id,children:s[18].value}),"\n",(0,n.jsx)(i.h3,{id:s[19].id,children:s[19].value}),"\n",(0,n.jsx)(i.p,{children:"The S3 bucket is already configured as a source in RunReveal. Each source requires a unique bucket."}),"\n",(0,n.jsx)(i.h3,{id:s[20].id,children:s[20].value}),"\n",(0,n.jsx)(i.p,{children:"IAM permissions are insufficient for RunReveal to access the bucket. Review your bucket policy to ensure that s3:GetObject and s3:ListBucket permissions exist for the bucket."}),"\n",(0,n.jsx)(i.h3,{id:s[21].id,children:s[21].value}),"\n",(0,n.jsx)(i.p,{children:"S3 event notifications are not configured or are misconfigured. Ensure that event notifications are set up per the intructions above and confirm that the SNS topic region matches the region of your S3 bucket."})]})},"/sources/object-storage/s3",{filePath:"pages/sources/object-storage/s3.mdx",timestamp:1754339758e3,pageMap:l.v,frontMatter:{title:"S3",description:"Configure AWS S3 bucket for log ingestion in RunReveal. Set up bucket policies, IAM roles, SNS notifications, and authentication for automated log processing."},title:"S3"},"undefined"==typeof RemoteContent?h:RemoteContent.useTOC)},95956:function(e,s,i){"use strict";i.d(s,{U:function(){return h}});var n=i(85893),r=i(90512),l=i(45192);let t={default:"\uD83D\uDCA1",error:"\uD83D\uDEAB",info:(0,n.jsx)(l.AV,{className:"_mt-1"}),warning:"⚠️"},a={default:(0,r.Z)("_border-orange-100 _bg-orange-50 _text-orange-800 dark:_border-orange-400/30 dark:_bg-orange-400/20 dark:_text-orange-300"),error:(0,r.Z)("_border-red-200 _bg-red-100 _text-red-900 dark:_border-red-200/30 dark:_bg-red-900/30 dark:_text-red-200"),info:(0,r.Z)("_border-blue-200 _bg-blue-100 _text-blue-900 dark:_border-blue-200/30 dark:_bg-blue-900/30 dark:_text-blue-200"),warning:(0,r.Z)("_border-yellow-100 _bg-yellow-50 _text-yellow-900 dark:_border-yellow-200/30 dark:_bg-yellow-700/30 dark:_text-yellow-200")};function h({children:e,type:s="default",emoji:i=t[s]}){return(0,n.jsxs)("div",{className:(0,r.Z)("nextra-callout _overflow-x-auto _mt-6 _flex _rounded-lg _border _py-2 ltr:_pr-4 rtl:_pl-4","contrast-more:_border-current contrast-more:dark:_border-current",a[s]),children:[(0,n.jsx)("div",{className:"_select-none _text-xl ltr:_pl-3 ltr:_pr-2 rtl:_pr-3 rtl:_pl-2",style:{fontFamily:'"Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"'},children:i}),(0,n.jsx)("div",{className:"_w-full _min-w-0 _leading-7",children:e})]})}}},function(e){e.O(0,[7812,4854,2888,9774,179],function(){return e(e.s=49635)}),_N_E=e.O()}]);